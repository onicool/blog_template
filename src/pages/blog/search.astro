---
// pages/blog/search.astro
import Layout from '../../layouts/Layout.astro';
import BlogCard from '../../components/BlogCard.astro';
import SearchComponent from '../../components/Search.astro'; // 名前を変更
import { getCollection } from 'astro:content';
import { searchPosts } from '../../lib/utils/search';

const query = Astro.url.searchParams.get('q') || '';
const allPosts = await getCollection('blog');
const searchResults = query ? await searchPosts(allPosts, query) : [];
---

<Layout title={`検索結果: ${query}`}>
  <main>
    <SearchComponent initialQuery={query} /> {/* コンポーネント名を変更 */}
    
    {query && (
      <p class="my-4">「{query}」の検索結果: {searchResults.length}件</p>
    )}
    
    <div class="grid gap-4">
      {searchResults.map(post => (
        <BlogCard post={post} />
      ))}
    </div>
    
    {query && searchResults.length === 0 && (
      <p>検索結果が見つかりませんでした。</p>
    )}
  </main>
</Layout>